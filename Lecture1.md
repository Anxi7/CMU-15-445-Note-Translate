# Lecture1 关系模型和关系代数

## 1. 数据库

**数据库**(DB)是对现实世界中某些方面进行建模的一个组织有序的、相互关联的数据集合  
人们通常将数据库与数据库管理系统相混淆。实际上，**数据库管理系统**(DBMS)是用来管理数据库的软件，而数据库则是数据的集合  
考虑一个建模数字音乐商店的数据库。该数据库中存储了艺人的信息以及他们发行了哪些专辑

## 2. 扁平文件稻草人

> 背景简介:  
> *稻草人体系结构* 通常指代一种简单、脆弱或者不完整的系统结构或架构。这个比喻源自于农田中的稻草人，它们被用来吓走鸟类等可能危害庄稼的动物，但*实际上并没有真正的功能*，只是一种虚设
>
> 在数据库领域，*flat file strawman* 通常指的是一种简单的、基于文本文件的数据存储方法，被视为在处理数据时不够灵活、不够高效的一种解决方案，强调了数据存储在扁平的文本文件中的局限和不足之处
>
> *扁平文件* 是一种简单的数据存储格式，通常以文本文件的形式存储，每行代表一个记录，字段之间可能使用特定的分隔符(如逗号、制表符等)进行分隔

在flat file strawman中，数据库被存储为由DBMS管理的逗号分隔值(comma-sparated value, CSV)文件。每一个实体都存储在自己独有的文件中。应用程序每次想要读取或更新记录时都必须解析文件。

```powershell
CSV文件是一种常见的文本文件格式，用于存储表格数据
在CSV文件中，每一行代表表格中的一行数据，而每一列的数据则通过逗号或其他分隔符进行分隔
CSV文件通常被用于在不同的程序之间传输数据，因为它是一种简单、通用的文件格式，几乎所有电子表格软件和数据库系统都能够读取和生成CSV文件
```

继续之前的数字音乐商店的例子，这里有两个文件：一个用于艺人，一个用于专辑。  

每个实体都有自己的属性集合，因此在每个文件中，不同的record通过换行分隔，而record中的每个相应属性通过逗号分隔。  

例如：艺人有名字、年龄、祖国属性，同时，专辑有名字、创作者和发行年份属性。  

下面是一个使用(name, year, country)模式存储艺人信息的CSV文件实例。

```powershell
Wu-Tang Clan, 1992, USA
Notorious BIG, 1992, USA
GZE, 1990, USA
```

- 扁平文件存在的问题
  - 数据完整性(Data Integrity)
    - 我们如何确保每个专辑条目中的艺人都是相同的？
    - 如果有人用无效的字符串覆盖了专辑年份怎么办？
    - 如果一个专辑由多个艺人共同完成怎么办？
    - 当我们删除有专辑的艺人会发生什么？
  - 实现(Implementation)
    - 我们应该如何找到特定的record
    - 如果我们现在想开发一个使用同一数据库的新应用应该怎么办？
    - 如果两个线程试图同时写入同一文件应该怎么办？ - 并发处理
  - 持久性(Durability)
    - 如果在我的程序更新一个record时，机器损坏了怎么办？
    - 如果我们想要在多台机器上复用同一数据库以获得高可用性怎么办？

## 3. 数据库管理系统(DBMS)

数据库管理系统(DBMS)是一个允许应用程序在一个数据库中存储和分析信息的软件。通用DBMS的设计目的是允许根据某种数据模型定义、创建、查询、更新和管理数据库。  

在数据库中，*data model*(数据模型)是用来描述数据的概念集合(描述数据、数据联系、数据语义及一致性约束)。例如：关系型(最常见), NoSQL(键值对、图), 数组/矩阵/向量等。  

*Schema*(模式)是基于data model的对特定数据集合的描述

### 早期的DBMS

因为逻辑层和物理层之间有很紧密的耦合性，所以数据库应用程序很难构建和维护。

逻辑层描述了数据库有哪些实体和属性，而物理层描述的是这些实体和关系应该如何存储。

早期时，物理层定义在应用程序代码中，因此，如果想要修改应用程序使用的物理层的话，我们必须修改所有的相关代码来适配新的物理层。

## 4. 关系模型

Ted Codd注意到人们总是在他们想要改变物理层时重写DBMS，因此他在1970年提出了关系模型来避免繁琐的重写DBMS过程。

关系模型(relational model)基于一些关系(关系指的是属性之间的某种联系)定义了一个数据库的抽象，以减少维护开销。它有三个关键点：

1. 在简单数据结构中存储数据库(关系 - 也就是表)
2. DBMS通过高级语言访问数据，找出最优执行策略(数据库系统中的查询优化器)
3. 物理存储交由DBMS实现

> 数据库抽象是指数据库系统中的概念和结构，它们隐藏了底层的实现细节，使用户和应用程序能够以更简单、一致的方式与数据交互。  
> 数据库抽象可以包括逻辑模型（如关系模型）、数据操作语言（如SQL）、数据完整性约束、数据安全性等方面的概念。  
> 这种抽象使得用户无需了解数据库的内部实现细节，而可以专注于如何有效地管理和操作数据。

关系数据模型定义了三个概念：

- 结构(Structure)：关系的定义和内容。包括了关系包含的属性以及这些属性可以取到的值(Domain - 域)。
- 完整性(Integrity)：确保数据库的内容满足约束。约束示例：年份属性的任意一个值必须是一个数字。
- 操作(Manipulation)：如何访问和修改数据库的内容

关系(*relation*)是包含表示实体的属性之间的关系的无序集合。正因为这些关系是无序的，所以DBMS可以以任何想要的方式存储他们，从而带来优化的可能。

元组(*tuple*)是关系中属性值的集合(也称为域 - domain)。起初，值必须是原子的或者标量的，但现在值也可以是列表或者嵌套数据结构。每一个属性都可以是一个特殊值NULL，这意味着对于一个给定元组，这个属性是未定义的。

> tuple就是我们所说的某个表中的一个记录（表就是一个关系）
>
> 关系、元组、属性大致构成一个从属关系，关系中包含了主码不同的各个元组，元组中包含了一定数量的属性值。
>
> 以前面的CSV文件为例，整个CSV文件中存储的数据构成了一个关系，其中的每条记录对应关系中的每个元组，这些元组中包含着三个不同的属性值。

一个有n个属性的关系被称为n元关系

### 码

一个关系的主码(*primary key*)唯一标识了一个元组。如果没有定义内部主码，某些DBMS会自动创建一个。许多DBMS支持自动生成主码，因此应用程序不需要手动设置主码，但是对于某些DBMS而言，主码仍是必需的。

外码(*foreign key*)规定一个关系中的一个属性必须映射到另一个关系中的一个元组上。

> 外码指定一个关系如何或者说通过哪些属性引用另一个关系
>
> 外码约束要求在引用关系中存在的每一个外码取值，都必须能够在被引用关系中找到（外码约束还要求被引用属性必须是被引用关系的主码）。
>
> 除了上面介绍的两种码之外，还有超码(*Super key*)和候选码(*candidate key*)
>
> 其中，超码指的是所有可以用来唯一标识某个元组的属性(集)；候选码指的是超码中的所有最小属性集，这里的最小指的是如果随意减少集合中的一个或多个属性(至少留下一个)，那么这个码将不再是超码。
